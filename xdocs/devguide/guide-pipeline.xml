<?xml version="1.0"?>
<!--
	Licensed to the Apache Software Foundation (ASF) under one or more
	contributor license agreements.  See the NOTICE file distributed with
	this work for additional information regarding copyright ownership.
	The ASF licenses this file to You under the Apache License, Version 2.0
	(the "License"); you may not use this file except in compliance with
	the License.  You may obtain a copy of the License at
	
	http://www.apache.org/licenses/LICENSE-2.0
	
	Unless required by applicable law or agreed to in writing, software
	distributed under the License is distributed on an "AS IS" BASIS,
	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	See the License for the specific language governing permissions and
	limitations under the License.
-->
<document>
	<properties>
		<title>Jetspeed-2 Pipeline</title>
		<subtitle>Documentation for Jetspeed-2 Pipeline</subtitle>
		<authors>
			<person name="David Le Strat" email="dlestrat@apache.org" />
		</authors>
	</properties>
	<body>
		<section name="Jetspeed-2 Pipeline">
			<p>As described below, one of key component of the Jetspeed-2 portal engine is its request pipeline.
			<br/><br/>
			<img src="devguide/images/j2-overview.gif" border="0"/>
			<br/>
			In Jetspeed-2 request are processed through a series of <code>Valve</code> assembled together as a
			pipeline.  
			</p>
		</section>
        <section name="Request Pipeline">
            <p>
            In Jetspeed-2, a request pipeline performs individual operations to the request.
            </p>
            <subsection name="Pipeline Concepts">
            <p>
            A <code>Pipeline</code> is made of <code>Valves</code> chained together in a chain of responsibility pattern.
            The <code>JetspeedPipeline</code> implementation assembles a ordered list of <code>Valves</code> that are
            processed sequentially.
            <br/><br/>
            <img src="images/pipeline-c.gif" border="0"/><br/><br/>
            <img src="images/pipeline-assembly.gif" border="0"/>
            </p>	
            </subsection>
            <subsection name="Jetspeed-2 Valves">
            <p>
            Jetspeed-2 provides various type of <code>Valve</code> as illustrated below:<br/><br/>
           	<img src="images/valve-c.gif" border="0"/><br/>
			The above valves serve the following purpose:
           	<table>
            	<tr>
            		<th>Valve Name</th>
            		<th>Description</th>
            	</tr>
            	<tr>
            		<td>ActionValve</td>
            		<td>Check if <code>PortletAction</code> needs to be processed and process it, if required.
            		Used in the portlet pipeline.</td>
            	</tr>
            	<tr>
            		<td>AggregateValve</td>
            		<td>Invokes all Layout components in render mode to aggregate the generated contents and
            		send the result to the client.</td>
            	</tr>
            	<tr>
            		<td>CapabilityValve</td>
            		<td>Identifies the browser and adds a <code>CapabilityMap</code> to the <code>RequestContext</code>.</td>
            	</tr>
            	<tr>
            		<td>CleanupValve</td>
            		<td>Looks for JSP pages that were pushed onto the <code>org.apache.jetspeed.renderStack</code>
					request attribute, and attempts to include them.</td>
            	</tr>
            	<tr>
            		<td>LoginValidationValve</td>
            		<td>Checks if a login attempt failed and determines the cause.</td>
            	</tr>
            	<tr>
            		<td>PasswordCredentialValve</td>
            		<td>Checks the PasswordCredential (only once) after a User is logged in and redirects to a 
            		change password page if necessary.</td>
            	</tr>
            	<tr>
            		<td>SecurityValve</td>
            		<td>Authenticates the user or redirects to Login if necessary, adds the
					authenticated Subject to the <code>RequestContext</code>.</td>
            	</tr>
            </table>
           	</p>
            </subsection>
        </section>

	</body>
</document>

