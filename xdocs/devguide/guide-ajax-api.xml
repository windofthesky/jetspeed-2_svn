<?xml version="1.0"?>
<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<document>
  <properties>
    <title>AJAX XML API</title>
    <subtitle>Documentation for Jetspeed-2 AJAX XML API</subtitle>
    <authors>
      <person name="David Sean Taylor" email="taylor@apache.org"/>
    </authors>
  </properties>
  <body>
<section name="AJAX XML API Overview">
<p>
The Jetspeed XML AJAX API is an XML-based API provided to AJAX clients for making
asynchronous requests to Jetspeed-2 services. </p>
<p>
Typical use cases:
</p>
<ul>
    <li><b>Page Customization and Portlet Placement</b> - To move, copy, add, or remove portlets on a page</li>
    <li><b>Layout Selection</b> - change the layout (number of rows and columns, size of columns) on a page</li>
    <li><b>Theme and Decorator Selection</b> - change the page theme and portlet decorators on a page.</li>
    <li><b>Portlet Selectors</b> - provide a select-list of portlets to the end user</li>
    <li><b>Security Configuration</b> - configure the security constraints or policy on a resource (page, portlet, folder, link, fragment), or portal wide</li>
    <li><b>Menu Configuration</b> - create and edit menus for the Jetspeed Site</li>			
	<li><b>General Administration</b> - all use cases for general administration have not yet been explored.</li>
</ul>
<subsection name='Secured Access'>
<p>
All AJAX XML API requests run through
a standard Jetspeed <a href='guide-pipeline.html'>Pipeline</a> request. This means that you can configure your AJAX
request with the usual array of Jetspeed components. The default AJAX pipeline secures
access to all requests. Each AJAX action may have its own security constraints. All
requests made to a page will use the declarative security constraints configured for that page.
AJAX request actions are enforced under edit or view mode, depending on the nature of the action.
</p>
</subsection>		
</section>	  
<section name='API'>
<p>
The AJAX XML API is simply a HTTP request-based API, communicating over a simple REST (Representational State Transfer) protocol.	
The API is accessed over HTTP via the "ajaxapi" servlet path on the portal URL:
<source><![CDATA[
http://hostname/contextname/ajaxapi
]]></source>
</p>
<subsection name='Request Parameters and the Page'>	
<p>Request Parameters specify the requested API action, and additional API parameters.
The page that a request is referencing is implied in the HTTP URL.
Thus if we are making a request to modify a page, the page is specified in the HTTP URL:
<source><![CDATA[
http://localhost:8080/jetspeed/ajaxapi/Public/db-browser.psml
]]></source>
The page location algorithm using standard Jetspeed Profiling rules to locate the page.
A page is actually not required in the URL, since the <a href='guide-profiler.html'>Jetspeed Profiler</a> will locate the page
for you. Example:
<source><![CDATA[
http://localhost:8080/jetspeed/ajaxapi
]]></source>
goes to the default page for the current user.
</p>	
<p>Request Parameters are specific to each API. One request parameter, the "action" parameter,
 is almost always required, (except in the default case). The default action is "action=getpage"
which returns an XML representation of the profile-located page in <a href='guide-psml.html'>PSML</a>. (PSML is an XML format).
See the table below for specific examples of request parameters.
</p>		
<p>Here are the APIs currently available:
</p>		
</subsection>
<subsection name='Get Page'>
<table>	
    <tr>
        <td>API:</td>
        <td>getpage</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxGetPage</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Get Page retrieves a page from the Page Manager store in <a href='guide-psml.html'>PSML</a> format.			
		</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>page</td>
				<td>implied in the URL</td>				
			</tr>
			<tr>
				<td>action</td>
				<td>getportlets (optional, this is the default action)</td>				
			</tr>			
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi/Public/content.psml
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
<status>success</status>
<action>getpage</action>
  <page hidden="false">
  <defaults layout-decorator="tigris" portlet-decorator="tigris"/>
  <name>public.psml</name>
  <path>/Public/public.psml</path>
  <title>Public Share</title>
  <short-title>Public Share</short-title>
  <metadata name="title" xml:lang="es">Carpeta compartida</metadata>
  <fragment id="ps-1000" type="layout" name="jetspeed-layouts::VelocityTwoColumns" decorator="">
    <fragment id="ps-1001" type="portlet" name="rss::RSS" decorator="">
      <property name="row" value="0"/>
      <property name="column" value="0"/>
    </fragment>
	<fragment id="ps-1002" type="portlet" name="demo::BookmarkPortlet" decorator="">
      <property name="row" value="1"/>
      <property name="column" value="1"/>
    </fragment>
	<fragment id="ps-1003" type="portlet" name="jsf-demo::CalendarPortlet" decorator="">
      <property name="row" value="0"/>
      <property name="column" value="1"/>
    </fragment>
	<fragment id="P-1080bff9b03-10000" type="portlet" name="jsf-demo::CalendarPortlet" decorator="">
      <property name="row" value="1"/>
      <property name="column" value="0"/>
    </fragment>
  </fragment>
</page>
</js>
]]></source>
			
		</td>    
	</tr>
</table>
</subsection>
<subsection name='Move Absolute'>
<table>		
    <tr>
        <td>API:</td>
        <td>moveabs</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxMovePortletAbsolute</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Move a portlet on a page to an absolute position specified in the row and col request parameters.</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>page</td>
				<td>implied in the URL</td>				
			</tr>
			<tr>
				<td>action</td>
				<td>moveabs</td>				
			</tr>			
			<tr>
				<td>id</td>
				<td>the portlet PSML fragment id of the portlet to be moved</td>				
			</tr>			
			<tr>
				<td>row</td>
				<td>the absolute new row location to place the portlet fragment (zero based)</td>				
			</tr>						
			<tr>
				<td>col</td>
				<td>the absolute new column location to place the portlet fragment (zero based)</td>				
			</tr>									
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi/Public/public.psml?action=moveabs&id=ps-1003&row=0&col=1			
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
   <status>success</status>
    <action>moveabs</action>
    <id>ps-1003</id>
	<old_position>
      <col>1</col>
      <row>1</row>
    </old_position>
	<new_position>
      <col>1</col>
      <row>0</row>
    </new_position>
</js>						
]]></source>
			
		</td>    
	</tr>
</table>
</subsection>
<subsection name='Move Relative'>
<table>		
    <tr>
        <td>APIs:</td>
        <td>moveleft, moveright, moveup, movedown</td>
    </tr>
    <tr>
        <td>Components:</td>
        <td>AjaxMovePortletLeft, AjaxMovePortletRight, AjaxMovePortletUp, AjaxMoveDown</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Move a portlet on a page relatively one position, based on the action.</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>page</td>
				<td>implied in the URL</td>				
			</tr>
			<tr>
				<td>action</td>
				<td>moveleft, moveright, moveup, movedown</td>				
			</tr>			
			<tr>
				<td>id</td>
				<td>the portlet PSML fragment id of the portlet to be moved</td>				
			</tr>			
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi/Public/public.psml?action=movedown&id=ps-1003
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
   <status>success</status>
    <action>movedown</action>
    <id>ps-1003</id>
	<old_position>
      <col>1</col>
      <row>0</row>
    </old_position>
	<new_position>
      <col>1</col>
      <row>1</row>
    </new_position>
</js>						
]]></source>
			
		</td>    
	</tr>

</table>
</subsection>
<subsection name='Move'>
<table>		
    <tr>
        <td>API:</td>
        <td>move</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxMovePortlet</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Move a portlet on a page to a cartesian position (x,y,z,width,height) from request parameters.</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>page</td>
				<td>implied in the URL</td>				
			</tr>
			<tr>
				<td>action</td>
				<td>move</td>				
			</tr>			
			<tr>
				<td>id</td>
				<td>the portlet PSML fragment id of the portlet to be moved</td>				
			</tr>			
			<tr>
				<td>x</td>
				<td>the portlet cartesian X position</td>				
			</tr>						
			<tr>
				<td>y</td>
				<td>the portlet cartesian Y position</td>				
			</tr>
			<tr>
				<td>z</td>
				<td>the portlte cartesian Z position</td>				
			</tr>
			<tr>
				<td>width</td>
				<td>the width of the portlet</td>				
			</tr>
			<tr>
				<td>height</td>
				<td>the height cartesian Y position</td>				
			</tr>            									
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi/Public/public.psml?action=move&id=ps-1003&x=100&y=250&width=200&height=300			
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
   <status>success</status>
    <action>move</action>
    <id>ps-1003</id>
	<old_position>
      <x>50</x>
      <y>155</row>
    </old_position>
	<new_position>
      <x>100</x>
      <y>250</y>
    </new_position>
</js>						
]]></source>			
		</td>    
	</tr>
</table>
</subsection>    
<subsection name='Add Portlet'>
<table>			
    <tr>
        <td>API:</td>
        <td>add</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxAddPortlet</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Adds a new portlet to the current page. The portlet can be added at a specified row and column.
		    If either the row or column or not specified, defaults to zero respectively.</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>page</td>
				<td>implied in the URL</td>				
			</tr>
			<tr>
				<td>action</td>
				<td>add</td>				
			</tr>			
			<tr>
				<td>id</td>
				<td>The portlet full name to be placed on the page, using Jetspeed Portlet Naming (PortletApplicationName::PortletName)</td>				
			</tr>			
			<tr>
				<td>row</td>
				<td>optional: the absolute new row location to place the new portlet fragment (zero based)</td>				
			</tr>						
			<tr>
				<td>col</td>
				<td>optional: the absolute new column location to place the new portlet fragment (zero based)</td>				
			</tr>									
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi/Public/public.psml?action=add&id=jsf-demo::CalendarPortlet
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
  <status>success</status>
  <action>add</action>
  <id>jsf-demo::CalendarPortlet</id>
  <new_position>
    <col>0</col>
    <row>0</row>
  </new_position>
</js>
]]></source>
			
		</td>    
	</tr>
</table>
</subsection>
<subsection name='Remove Portlet'>
<table>		

    <tr>
        <td>API:</td>
        <td>remove</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxRemovePortlet</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Removes a new portlet from the current page.</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>page</td>
				<td>implied in the URL</td>				
			</tr>
			<tr>
				<td>action</td>
				<td>remove</td>				
			</tr>			
			<tr>
				<td>id</td>
				<td>the portlet PSML fragment id of the portlet to be removed</td>				
			</tr>			
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi/Public/public.psml?action=remove&id=ps-1003
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
  <status>success</status>
  <action>remove</action>
  <id>jsf-demo::CalendarPortlet</id>
  <new_position>
    <col>0</col>
    <row>0</row>
  </new_position>
</js>
]]></source>
			
		</td>    
	</tr>
</table>
</subsection>
<subsection name='Get Portlets'>
<table>		

    <tr>
        <td>API:</td>
        <td>getportlets</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxGetPortlets</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Get Portlets retrieves the (sorted) portlet list available to the current subject, filtered
		    the portlet list, and returning portlets which the current subject may view. 
			The Jetspeed (JAAS) security policy enforces this filtering. Portlets are returned 
		    in XML format, with name, displayName, and description for each portlet.</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>page</td>
				<td>implied in the URL</td>				
			</tr>
			<tr>
				<td>action</td>
				<td>getportlets</td>				
			</tr>			
			<tr>
				<td>filter</td>
				<td>not yet implemented. A query filter to be defined.</td>				
			</tr>			
			
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi?action=getportlets
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
<status>success</status>
<action>getportlets</action>
-
	<portlets>
<portlet name="demo::AttributeScopePortlet" displayName="Attribute Scope Demo" description="$portlet.Description">
        </portlet>
<portlet name="demo::BookmarkPortlet" displayName="Bookmark Portlet" description="Bookmark Portlet">
        </portlet>
<portlet name="demo::BookmarkPortletForXHTMLBasic" displayName="Bookmark Portlet for XHTML Basic" description="Bookmark Portlet for XHTML Basic">
        </portlet>
<portlet name="demo::CSSDemoPortlet" displayName="CSS Demo Portlet" description="$portlet.Description">
        </portlet>
....
<portlet name="rss::RSS" displayName="RSS Portlet" description="RSS Portlet">
        </portlet>
<portlet name="rss::RomeRSS" displayName="Rome RSS Portlet" description="Rome RSS Portlet">
        </portlet>
</portlets>
</js>
]]></source>
			
		</td>    
	</tr>				
</table>        
</subsection>	
    
<subsection name='Permissions'>
<table>		

    <tr>
        <td>API:</td>
        <td>permissions</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxSecurityPermissions</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Security Permissions Maintenance to add, update, and remove permissions from the Jetspeed security policy</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>action</td>
				<td>permissions</td>				
			</tr>			            
			<tr>
				<td>method</td>
				<td>the method to execute: must be of value: add | update | remove</td>				
			</tr>
			<tr>
				<td>type</td>
				<td>the type of permission being manipulated: portlet | folder | page</td>				
			</tr>			
			<tr>
				<td>resource</td>
				<td>the name of the portal resource being manipulated</td>				
			</tr>			            
			<tr>
				<td>roles</td>
				<td>comma-separated list of roles, only valid for methods: add, update</td>				
			</tr>			                        
			<tr>
				<td>actions</td>
				<td>comma-separated list of actions, only valid for methods: add, update</td>				
			</tr>			                        
			<tr>
				<td>oldactions</td>
				<td>comma-separated list of previous actions, only valid for methods: update</td>				
			</tr>			                                    
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi?action=permissions&method=add&type=portlet&resource=demo::*&roles=role1,role2,role3&actions=view,edit
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
    <status>success</status>
    <action>permissions</action>
    <resource>demo::*</resource> 
    <type>portlet</type> 
    <actions>view,edit</actions>
    <actions>role1,role2,role3</actions>    
</js>
]]></source>		
		</td>    
	</tr>
</table>
</subsection>

<subsection name='getmenus'>
<table>		

    <tr>
        <td>API:</td>
        <td>getmenus</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxGetMenus</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Retrieves all menus for the current page (implied in URL)</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>action</td>
				<td>getmenus</td>				
			</tr>			            
			<tr>
				<td>page</td>
				<td>(implied in URL)</td>				
			</tr>
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi/default-page.psml?action=getmenus
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
    <status>success</status>
    <action>getmenus</action>    
    <menus>
        <menu type="standard">navigations</menu>
        <menu type="standard">back</menu>
        <menu type="standard">pages</menu>
        <menu type="standard">breadcrumbs</menu>
        <menu type="custom">site-navigations</menu>
        <menu type="custom">additional-links</menu>
        <menu type="custom">page-navigations</menu>
    </menus>
</js>
]]></source>		
		</td>    
	</tr>
</table>
</subsection>

<subsection name='getmenu'>
<table>		

    <tr>
        <td>API:</td>
        <td>getmenu</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxGetMenu</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Retrieves the menu definition for a given menu</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>action</td>
				<td>getmenu</td>				
			</tr>			            
			<tr>
				<td>menu</td>
				<td>name of the menu to retrieve (menu definition may change per page)</td>				
			</tr>
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi?action=getmenu&name=breadcrumbs
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
<status>success</status>
<action>getmenu</action>
<menu>
  <name>breadcrumbs</name>
  <title>You are here:</title>
  <short-title>You are here:</short-title>
  <skin>breadcrumbs</skin>
  <url>/default-page.psml</url>
  <hidden>false</hidden>
  <selected>true</selected>
  <option>
    <type>folder</type>
    <title>Root Folder</title>
    <short-title>Root Folder</short-title>
    <skin>breadcrumbs</skin>
    <url>/</url>
    <hidden>false</hidden>
    <selected>true</selected>
  </option>
  <option>
    <type>page</type>
    <title>Welcome to Jetspeed 2</title>
    <short-title>Welcome to Jetspeed 2</short-title>
    <skin>blue</skin>
    <url>/default-page.psml</url>
    <hidden>false</hidden>
    <selected>true</selected>
  </option>
</menu>
</js>
]]></source>		
		</td>    
	</tr>
</table>
</subsection>

<subsection name='window'>
<table>		

    <tr>
        <td>API:</td>
        <td>getmenus</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxChangeWindow</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Changes a portlet window's Window State or Portlet Mode</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>action</td>
				<td>window</td>				
			</tr>			            
			<tr>
				<td>id</td>
				<td>window id of the portlet to be modified</td>				
			</tr>
			<tr>
				<td>state</td>
				<td>A portlet api valid window state or extended window state (normal | maximized | minimized)</td>				
			</tr>            
			<tr>
				<td>mode</td>
				<td>A portlet api valid portlet mode or extended portlet mode (view | edit | help | print)</td>				
			</tr>                        
			<tr>
				<td>page</td>
				<td>Implied in URL</td>				
			</tr>                                    
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi?action=window&state=maximized&mode=edit&id=um-2
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
  <status>success</status>
  <action>window</action>
  <id>um-2</id>  
  <state>maximized</state>
  <mode>edit</mode>
</js>
]]></source>		
		</td>    
	</tr>
</table>
</subsection>

<subsection name='getuseinfo'>
<table>		

    <tr>
        <td>API:</td>
        <td>getuseinfo</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxGetUserInformation</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Returns information about the currently logged in user. Can be used for example in AJAX based portlets to retrieve the userinfo in a more robust way. Will return success only if a user is currenly logged in, otherwise will return false.</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>action</td>
				<td>getuserinfo</td>				
			</tr>                                   
		</table>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi?action=getuserinfo
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
    <status>success</status>
    <action>userinformation</action>
    <username>admin</username> 
    <type>org.apache.jetspeed.security.impl.UserPrincipalImpl</type>
    <userinfo>
        <user.name.given>Test Dude</user.name.given>
        <user.name.family>Dudley</user.name.family>
    </userinfo>
</js>
]]></source>		
		</td>    
	</tr>
</table>
</subsection>

<subsection name='getuserlist'>
<table>		

    <tr>
        <td>API:</td>
        <td>getuseinfo</td>
    </tr>
    <tr>
        <td>Component:</td>
        <td>AjaxGetUserList</td>
    </tr>
    <tr>
        <td>Description:</td>
        <td>Provides basic information (username, ip-address, number of sessions and status) about currently logged in users in xml-format. Optionally it can also provide more detailed userinformation, number of guest sessions and include offline users as well.</td>
    </tr>
    <tr>
        <td>Parameters:</td>
        <table>
			<tr>
				<td>action</td>
				<td>getuserinfo</td>
			</tr>
            <tr>
                <td>userinfo</td>
                <td>Whether we should include also userinfo (true | false [default])</td>
            </tr>
            <tr>
                <td>offline</td>
                <td>Whether we should include offline users (true | false [default])</td>
            </tr>
            <tr>
                <td>guest</td>
                <td>Whether we should return also the guest sessions (true | false [default])</td>
            </tr>
            <tr>
                <td>all</td>
                <td>If set to true, will return every bits and piece there is (true | false [default])</td>
            </tr>
		</table>
    </tr>
    <tr>
        <td>
            <p>
                By default the private information (emails, etc..) is protected with
                RolesSecurityBehavior security, but can be changed in 
                <a href="http://svn.apache.org/viewvc/portals/jetspeed-2/portal/branches/JETSPEED-2.1.3-POSTRELEASE/src/webapp/WEB-INF/assembly/ajax-layout.xml?view=markup">AJAX configuration</a>
                by altering the protectionScope constructor value to either "all" to protect
                even the basic information or to "none" when everything will be shown for everyone (not wise on production).
                The default value "private" will show just the basic information of online/offline users and number of guest sessions,
                as the "private-offline" will not show even the offline users. Possible protectionScope values are "all",
                "private-offline", "private" and "none".
            </p>
        </td>
    </tr>
    <tr>
        <td>API example:</td>
		<td>
<source><![CDATA[			
http://localhost:8080/jetspeed/ajaxapi?action=getuserlist&userinfo=true&guest=true
]]></source>			
		</td>    
	</tr>
    <tr>
        <td>XML Response:</td>
		<td>
<source><![CDATA[
<js>
    <status>success</status>
    <action>getuserlist</action>
    <users>
        <user>
            <username>admin</username>
            <sessions>1</sessions>
            <status>online</status>
            <ipaddress>127.0.0.1</ipaddress>
            <userinfo>
                <user.name.given>Test Dude</user.name.given>
                <user.name.family>Dudley</user.name.family>
            </userinfo>
        </user>
        <guests>0</guests>
    </users>
</js>
]]></source>		
		</td>    
	</tr>
</table>
</subsection>
        
</section>

<section name='Spring Assembly'>
<p>
The <code>AjaxRequestService</code>	is a Spring component that handles AJAX requests.
It is hooked into the AJAX <a href='guide-pipeline.html'>Pipeline</a> for special processing
of AJAX request. Here is the Spring Assembly. Each API is configured in the Ajax Service.
</p>
<source><![CDATA[	
<bean id="AjaxRequestService" class="org.apache.jetspeed.ajax.AjaxRequestServiceImpl">
    <constructor-arg index="0">
        <map>
            <entry key="move">
                <ref bean="AjaxMove"/>
            </entry>            
            <entry key="moveabs">
                <ref bean="AjaxMovePortletAbsolute"/>
            </entry>
            <entry key="moveleft">
                <ref bean="AjaxMovePortletLeft"/>
            </entry>
            <entry key="moveright">
                <ref bean="AjaxMovePortletRight"/>
            </entry>
            <entry key="moveup">
                <ref bean="AjaxMovePortletUp"/>
            </entry>
            <entry key="movedown">
                <ref bean="AjaxMovePortletDown"/>
            </entry>
            <entry key="add">
                <ref bean="AjaxAddPortlet"/>
            </entry>
            <entry key="remove">
                <ref bean="AjaxRemovePortlet"/>
            </entry>
            <entry key="getportlets">
                <ref bean="AjaxGetPortlets"/>
            </entry>
            <entry key="getpage">
                <ref bean="AjaxGetPage"/>
            </entry>
            <entry key="getpages">
                <ref bean="AjaxGetPages"/>
            </entry>			
            <entry key="getfolder">
                <ref bean="AjaxGetFolder"/>
            </entry>			            
            <entry key="getlink">
                <ref bean="AjaxGetLink"/>
            </entry>			                        
            <entry key="getfolderlist">
                <ref bean="AjaxGetFolderList"/>
            </entry>			                        
            <entry key="getfolders">
                <ref bean="AjaxGetFoldersList"/>
            </entry>			      						
            <entry key="getthemes">
                <ref bean="AjaxGetThemes"/>
            </entry>
            <entry key="getactions">
                <ref bean="AjaxGetActions"/>
            </entry>
            <entry key="window">
                <ref bean="AjaxChangeWindow"/>
            </entry>
            <entry key="getmenus">
                <ref bean="AjaxGetMenus"/>
            </entry>			            
            <entry key="getmenu">
                <ref bean="AjaxGetMenu"/>
            </entry>			            
            <entry key="permissions">
                <ref bean="AjaxSecurityPermissions"/>
            </entry>			                        
            <entry key="constraints">
                <ref bean="AjaxSecurityConstraints"/>
            </entry>			          
            <entry key="updatefolder">
                <ref bean="AjaxUpdateFolder"/>                
            </entry>                          
            <entry key="updatepage">
                <ref bean="AjaxUpdatePage"/>                
            </entry>              
            <entry key="updatelink">
                <ref bean="AjaxUpdateLink"/>                
            </entry>                                                              
            <entry key="getuserinfo">
                <ref bean="AjaxGetUserInformation"/>                
            </entry>
            <entry key="getuserlist">
                <ref bean="AjaxGetUserList"/>                
            </entry>
        </map>
    </constructor-arg>
    <constructor-arg index="1">
        <ref bean="AjaxVelocityEngine"/>
    </constructor-arg>
</bean>
]]></source>
		
</section>	
</body>
</document>

