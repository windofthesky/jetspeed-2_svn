<?xml version="1.0"?>
<!--
	Licensed to the Apache Software Foundation (ASF) under one or more
	contributor license agreements.  See the NOTICE file distributed with
	this work for additional information regarding copyright ownership.
	The ASF licenses this file to You under the Apache License, Version 2.0
	(the "License"); you may not use this file except in compliance with
	the License.  You may obtain a copy of the License at
	
	http://www.apache.org/licenses/LICENSE-2.0
	
	Unless required by applicable law or agreed to in writing, software
	distributed under the License is distributed on an "AS IS" BASIS,
	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	See the License for the specific language governing permissions and
	limitations under the License.
-->
<document>
	<properties>
		<title>Jetspeed MFA Portlet App</title>
		<subtitle>Welcome to Jetspeed Portlet Application Multifaceted Authentication</subtitle>
		<authors>
			<person name="David Sean Taylor" email="taylor@apache.org" />
		</authors>
	</properties>
	<body>
		<section name="Using the Jetspeed MFA Portlet">
		<p>This portlet application provides multi-faceted login portlet functionality including captcha and personal questions. Since this is a login portlet, it has minimal hooks to authenticate against Jetspeed. You should be able to easily adapt this portlet application to other portals by changing the authentication code.</p>
		<subsection name='Usage with Jetspeed'>
		<p>There is one portlet found in the portlet.xml: <b>MFALogin</b>. This portlet is configured in the portlet.xml with the following init parameters:</p>
<table>
<tr>
<th>param name</th>
<th>default value</th>
<th>description</th>
</tr>
<tr>
<td>cookieLifetime</td>
<td>345600</td>
<td>The lifetime of the stored cookie in seconds (4 days)</td> 
</tr>
<tr>
<td>maxNumberOfAuthenticationFailures</td>
<td>5</td>
<td>Maximum number of authentication failures before disabling a user</td>
</tr>
<tr>
<td>randomQuestions</td>
<td>What was the first and last name of our favorite teacher? In what city did you get married? ...</td>
<td>A list of 24 personal questions which will be displayed to the user in random order separated by question marks (?)</td>
</tr>
</table>
<p><b>IMPORTANT</b>The Jetspeed web.xml must be modified. The <i>LoginProxyServlet</i> servlet must have its <i>credentialsFromRequest</i> init param set to false:</p>
<source><![CDATA[
<servlet>
    <servlet-name>LoginProxyServlet</servlet-name>
    <servlet-class>org.apache.jetspeed.login.LoginProxyServlet</servlet-class>
	<init-param>
		<param-name>credentialsFromRequest</param-name>
		<param-value>false</param-value>
	</init-param>        
</servlet>
]]></source>		
		</subsection>
		<subsection name='Captcha'>
<p>
The following  Captcha properties are configured in the mfa.properties found in the WEB-INF directory of your web application.
</p>
<h2>Property File</h2>
<table border='1'>
<tr>
<th>Property</th>
<th>Default Value</th>
<th>Description</th>
<tr>
<td>captcha.directory</td>
<td>/captchas</td>
<td>The directory where all captchas will be stored when generated. For web applications, this directory should be a in a public viewable area.
The directory name is relative to either the running program, or in the case of a web application, relative to the root of the web application</td>
</tr>
<tr>
<td>captcha.effects.noise</td>
<td>false</td>
<td>Turn on the default noise generation for a capcha. Noise generation is not yet configurable to a fine grain but instead enables a set of general noise algorithms including
drawing an XORed oval behind the text, and generating gray noise throughout the image.
This feature is turned off by default and should not be used with an image background.</td>
</tr>
<tr>
<td>captcha.image.background</td>
<td>images/jetspeedlogo98.jpg</td>
<td>Uses an image file as the background for the capcha image. The default provide is a company logo that has been run through a matte effect.</td>
</tr>
<tr>
<td>captcha.image.background.use</td>
<td>true</td>
<td>Enable or disable using the background image defined in the captcha.image.background property.</td>
</tr>
<tr>
<td>catcha.image.format</td>
<td>.jpg</td>
<td>The image format of the output captcha file. Known supported formats are .jpg and .png</td>
</tr>
<tr>
<td>captcha.font.antialiasing</td>
<td>true</td>
<td>Enable or disable antialiasing. By enabling, you will generate a clearer image at the cost of slower rendering times.</td>
</tr>
<tr>
<td>captcha.font.size</td>
<td>36</td>
<td>The point size of the font.</td>
</tr>
<tr>
<td>captcha.font.style</td>
<td>0</td>
<td>The style of the font. Valid values are: PLAIN == 0, BOLD == 1, ITALIC == 2, BOLD_ITALIC == 3</td>
</tr>
<tr>
<td>captcha.font.names</td>
<td>Times</td>
<td>A comma-separated list of font names. Make sure your server supports all listed fonted. When more than one font listed, fonts will be randomized.</td>
</tr>
<tr>
<td>captcha.scanrate.seconds</td>
<td>300</td>
<td>Configures the cleanup thread for removal of captchas images. The cleanup thread will run by default every 300 seconds.</td>
</tr>
<tr>
<td>captcha.timetolive.seconds</td>
<td>120</td>
<td>Configures the lifetime of a captcha image. Default is 120 seconds before it is deleted.</td>
</tr>
<tr>
<td>captcha.text.maxlength</td>
<td>8</td>
<td>The maximum number of characters generated for the captcha string. Randomly used with captcha.text.minlength to vary the size of the captcha string.</td>
</tr>
<tr>
<td>captcha.text.margin.left</td>
<td>2</td>
<td>The left-side margin where to start drawing the captcha string in in a device-independent coordinates.</td>
</tr>
<tr>
<td>captcha.text.margin.bottom</td>
<td>10</td>
<td>The bottom margin where to start drawing the captcha string in in a device-independent coordinates.</td>
</tr>
<tr>
<td>captcha.text.minlength</td>
<td>6</td>
<td>The minimum number of characters generated for the captcha string. Randomly used with captcha.text.maxlength to vary the size of the captcha string.</td>
</tr>
<tr>
<td>captcha.text.rise.range</td>
<td>30</td>
<td>The rise from the bottom margin where to start drawing the captcha string. Setting to zero turns off the rising feature.
If a positive number is used, the rise will randomly vary between the bottom margin and maximum rise value.</td>
</tr>
<tr>
<td>captcha.text.rotation</td>
<td>10</td>
<td>Sets the rotation (vertical alignment variance) of a glyph to control this. The value is in radians. 
Value should be a positive number or zero. For example, setting to 35, will rotate the glyph randomly between -35 and 35 radians.
Setting this value to 0 will turn off rotation.
</td>
</tr>
<tr>
<td>captcha.text.shear</td>
<td>0</td>
<td>Shearing slides one edge of an image along the X or Y axis, creating a parallelogram.
The default value is 0, turning off all shearing effects. Shearing effects can make it more difficult for non-human readers to read the image.
Shear values are specified in radians, with values closer to 1.0 creating a more drastic shearing effect.</td>
</tr>
<tr>
<td>captcha.text.spacing</td>
<td>2</td>
<td>The space between captcha characters in device-independent coordinates. 0 is a valid value, but can make it difficult to read glyphes when combined with rotations.</td>
</tr>
<tr>
<td>captcha.timestamp</td>
<td>true</td>
<td>Boolean value to enable printing a timestamp at the bottom of the captcha image in a small monospaced font.</td>
</tr>
<tr>
<td>captcha.timestamp.24hr</td>
<td>true</td>
<td>Boolean value set to true when using 24 hour clock on timestamp, otherwise 12 hour clock.</td>
</tr>
<tr>
<td>captcha.timestamp.tz</td>
<td>America/New_York</td>
<td>The Time Zone ID (TZID). The timestamp will be displayed for this timezone. You can also use timezone abbreviations such as EDT (Eastern Daylight Time).</td>
</tr>
<td>captcha.timestamp.font.size</td>
<td>8</td>
<td>The font size of the timestamp.</td>
</tr>

</table>
		
		</subsection>
		</section>
	</body>
</document>