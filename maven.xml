<project default="java:jar"
         xmlns:j="jelly:core"
         xmlns:maven="jelly:maven">

  <goal name="allClean"
        description="Clean the master project and all subprojects">
    <attainGoal name="subClean"/>
    <attainGoal name="clean"/>
  </goal>

  <goal name="subClean"
        description="Clean all subprojects"
        >
    <maven:reactor
               basedir="${basedir}"
               includes="*/project.xml,applications/*/project.xml"
               excludes="applications/project.xml"
               goals="clean"
               banner="Cleaning"
               ignoreFailures="false"/>
  </goal>

  <goal name="allSite"
        description="Build the site for the master project and all subprojects"
        >
    <maven:reactor
               basedir="${basedir}"
               includes="site/project.xml"
               goals="allSite"
               banner="Building Site"
               postProcessing="false"
               ignoreFailures="false"/>
  </goal>

  <goal name="allBuild"
        description="Build all jars and war">
    <!-- Build jars -->
    <maven:reactor
               basedir="${basedir}"
               includes="portlet-api/project.xml"
               goals="jar:install"
               banner="Build and Install the Portlet API jar"
               postProcessing="false"
               ignoreFailures="false"/>
    <maven:reactor
               basedir="${basedir}"
               includes="mockobjects/project.xml"
               goals="jar:install"
               banner="Build and Install the MockObjects jar"
               postProcessing="false"
               ignoreFailures="false"/>
    <maven:reactor
               basedir="${basedir}"
               includes="cps/project.xml"
               goals="jar:install"
               banner="Build and Install the portlet commons services jar"
               postProcessing="false"
               ignoreFailures="false"/>
    <maven:reactor
               basedir="${basedir}"
               includes="plugin/project.xml"
               goals="jar:install"
               banner="Build and Install the Plugin jar"
               postProcessing="false"
               ignoreFailures="false"/>
    <maven:reactor
               basedir="${basedir}"
               includes="commons/project.xml"
               goals="jar:install"
               banner="Build and Install the common jar"
               postProcessing="false"
               ignoreFailures="false"/>
    <maven:reactor
               basedir="${basedir}"
               includes="container/project.xml"
               goals="jar:install"
               banner="Build and Install the container jar"
               postProcessing="false"
               ignoreFailures="false"/>
    
     <!-- Build war files -->
     <maven:reactor
               basedir="${basedir}"
               includes="portal/project.xml"
               goals="db.test.recreate,db.recreate,war:install"
               banner="Build and Install the Portlet WAR"
               postProcessing="false"
               ignoreFailures="false"/>

     <maven:reactor
               basedir="${basedir}"
               includes="applications/demo/project.xml"
               excludes="applications/project.xml"
               goals="war:install"
               banner="Build and Install the Demo application WAR"
               postProcessing="false"
               ignoreFailures="false"/>
               
          <attainGoal name="copy.shared.deps" />
  </goal>
  
  <goal name="copy.shared.deps"> 
      <maven:reactor
               basedir="${basedir}"
               includes="portal/project.xml"
               goals="catalina:base-shared"
               banner="Deploys misc. jars shared/lib  to Tomcat"
               postProcessing="false"
               ignoreFailures="false"/>

     <maven:reactor
               basedir="${basedir}"
               includes="portal/project.xml"
               goals="catalina:shared"
               banner="Deploys container jars to shared/lib to Tomcat"
               postProcessing="false"
               ignoreFailures="false"/>  
  </goal>

</project>
