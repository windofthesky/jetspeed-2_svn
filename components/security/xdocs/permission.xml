<?xml version="1.0"?>
<!--
    Copyright 2004 The Apache Software Foundation
    
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
    
    http://www.apache.org/licenses/LICENSE-2.0
    
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<document>
    <properties>
        <title>Jetspeed 2 Security - PermissionManager Overview</title>
        <authors>
            <person name="David Le Strat" email="dlestrat@apache.org" />
        </authors>
    </properties>
    <body>
        <section name="PermissionManager Overview">
            <p>The <code>PermissionManager</code> is used by the <code>RdbmsPolicy</code> to get the permissions for
            a given user principals as presented 
            in the <a href="atz-jaas.html#Jetspeed_JAAS_Policy">Jetspeed JAAS Policy</a> section of the documentation.
            </p>
            <p>
            The <code>PermissionManager</code> manages the association between permissions and principals.  Each permission
            or  principal maps to a generic object model and reflexion is used to instantiate the proper permission or
            principal type.  The class diagram below represents the interfaces representing a generic permission 
            (<code>InternalPermission</code>) and a generic principal (<code>InternalPrincipal</code>) and their relation
            to the <code>PermissionManager</code>.
            </p>
            <p>
            <img src="images/permission-mgr-c.gif" border="0" />
            </p>
            <p>
            Each <code>InternalPermission</code> maps to one or more <code>InternalPrincipal</code> and, each 
            <code>InternalPrincipal</code> can have one or more <code>InternalPermission</code>.
            </p>
            <p>
            <img src="images/permissions-principals-om-c.gif" border="0" />
            </p>
        </section>
        <section name="Schema and OJB Mapping">
            <p>
            The OJB mappings for the security component are described in <code>security_repository.xml</code>:
            <ul>
            <li><code>InternalPrincipal</code>: Maps to the <code>SECURITY_PRINCIPAL</code> table.</li>
            <li><code>InternalPermission</code>: Maps to the <code>SECURITY_PERMISSION</code> table.</li>
            <li>Associations between <code>InternalPrincipal</code> and <code>InternalPermission</code> are
            maintained through the indirection table <code>PRINCIPAL_PERMISSION</code>.</li>
            </ul>
            <source><![CDATA[
<class-descriptor
	    class="org.apache.jetspeed.security.om.impl.InternalPrincipalImpl"
	    proxy="dynamic"
	    table="SECURITY_PRINCIPAL"
	>...</class-descriptor>
	
<class-descriptor
	    class="org.apache.jetspeed.security.om.impl.InternalPermissionImpl"
	    proxy="dynamic"
	    table="SECURITY_PERMISSION"
	>...</class-descriptor>      
            ]]>
            </source>
            </p>
            <p>
            The relational schema maintaining principal to permission associations is provided below:
            </p>
            <p>
            <img src="images/permissions-principals-schema.gif" border="0" />
            </p>
        </section>
    </body>
</document>